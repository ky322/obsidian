- Given two calibrated cameras with known parameters $P_1, P_2$
- Goal: find $\vec{x}_{\text{img}}$ the 3D world of point
- 3D World Point defined as $\begin{bmatrix}X\\ Y\\ Z \\ 1\end{bmatrix}$
- ![[Pasted image 20240307022703.png]]
- Consider $\vec{x}_{\text{img1}}\equiv P_1\vec{x_w}\to\lambda\vec{x}_{\text{img1}}=P_1\vec{x_w}$
	- $\begin{bmatrix}\lambda x_1\\ \lambda y_1\\ \lambda\end{bmatrix}=P_1\begin{bmatrix}X\\ Y\\ Z \\ 1\end{bmatrix}$
- Expanding
	- $\begin{bmatrix}\lambda x_1 \\ \lambda y_1 \\ \lambda\end{bmatrix} = \begin{bmatrix} P_{11} & P_{12} & P_{13} & P_{14} \\ P_{21} & P_{22} & P_{23} & P_{24} \\ P_{31} & P_{32} & P_{33} & P_{34}\end{bmatrix}\begin{bmatrix} X \\ Y \\ Z \\ 1\end{bmatrix}$
	- $\lambda x =P_{11}X + P_{12}Y + P_{13}Z + P_{14}$
	- $\lambda y =P_{21}X + P_{22}Y + P_{23}Z + P_{24}$
	- $\lambda =P_{31}X + P_{32}Y + P_{33}Z + P_{34}$
- Substitute $\lambda$ into $\lambda x$
	- $(P_{31}X + P_{32}Y + P_{33}Z + P_{34})x=P_{11}X + P_{12}Y + P_{13}Z + P_{14}$
- Reorder
	- $X(P_{31}X -P_{11})+Y(P_{32}X -P_{12})+X(P_{33}X -P_{13})+(P_{34}X -P_{14})=0$
- Repeat for Y
- Two linear equations
	- A linear equation in 3D represents a plane
	- Intersection of two planes defined by two linear equations represents a line
		- Line specifies ray connecting pixel and pinhole
- Two lines in 3D will not necessarily intersect so no solution guarantee
	- $\underline{p}=\begin{bmatrix}X\\ Y\\ Z\end{bmatrix}, A\underline{p}=\underline{b}$
	- $A:4\times3, \underline{b}=4\times1\to$four equations three unknown
- Find 3D point closest to all four equations where sum of squared distances from point to any line is smallest $\min_{\underline{p}}||A\underline{p}-\underline{b}||^2$
	- Normal equation $\underline{p*}=(A^TA)^{-1}A^T\underline{b}$
- Minimize reprojection error can be used as least squares minimization
	- 3D point is projected onto image to get $\begin{bmatrix}\hat{x_1}\\\hat{y_1}\end{bmatrix}\to\begin{bmatrix}{x_1}\\ {y_1}\end{bmatrix}$
	- One minimizes total reprojection error in image one and two over unknowns to ensure $\hat{x}$ is as close to $x$ and same for $y$
	- $\min_{X,Y,Z}=[(x_1-\hat{x_1})^2+(y_1-\hat{y_1})^2+(x_2-\hat{x_2})^2+(y_2-\hat{y_2})^2]$
- Camera can be arbitrary locations and orientations
- Camera parallels and translated along x axis
	- $P_1=K\begin{bmatrix}R & \vec{t}\end{bmatrix}=\begin{bmatrix}I & \vec{0}\end{bmatrix}$
- Camera 2 translated along x-axis with distance b
	- $P_2=\begin{bmatrix}I & \vec{t}\end{bmatrix}=\begin{bmatrix}1 & 0 & 0 & -b\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\end{bmatrix}$
- Effect for a 3D point $\begin{bmatrix}X\\ Y\\ Z\\1\end{bmatrix}$
	- Camera 1: $\begin{bmatrix}1 & 0 & 0 & 0\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\end{bmatrix}\begin{bmatrix}X\\ Y\\ Z\\1\end{bmatrix}=\begin{bmatrix}X\\ Y\\ Z\end{bmatrix}$
	- Camera 2: $\begin{bmatrix}1 & 0 & 0 & -b\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\end{bmatrix}\begin{bmatrix}X\\ Y\\ Z\\1\end{bmatrix}=\begin{bmatrix}X-b\\ Y\\ Z\end{bmatrix}$
- Convert to 2D Cartesian
	- $(\frac X Z, \frac Y Z) \& (\frac {X-b}{Z}, \frac Y Z)$
	- Y coordinate is the same
	- Simplifies searching for corresponding pixels since it is in same row
- Disparity: X coordinate differ by $\frac {-b} Z$
	- $Z=\frac{-b}{\text{disparity}}$
	- 